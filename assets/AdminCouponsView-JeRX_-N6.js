import{P as A}from"./PaginationComponent-_5M4BN6w.js";import{_ as P,M as T,r as p,o as _,j as y,w as D,b as o,t as d,a,n as b,d as w,v as E,c as C,F as f,g as k}from"./index-2BssBkm8.js";import{t as M,a as x}from"./utils-sTL9UzG1.js";import{D as I}from"./DeleteModalComponent-568cdfdp.js";var R={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_API_NAME:"ektodorwang-api",BASE_URL:"/ghibli-store/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:v,VITE_APP_API_NAME:g}=R,S={data(){return{coupon:{},modal:null,dateFormat:new Date,isCreateCoupon:!1}},props:["tempCoupon"],watch:{tempCoupon(){this.coupon=JSON.parse(JSON.stringify(this.tempCoupon)),this.isCreateCoupon=!(Object.keys(this.coupon).length>0),this.dateFormat=this.isCreateCoupon?this.timestampToTwTime(new Date().setDate(new Date().getDate()+7)/1e3):this.timestampToTwTime(this.coupon.due_date),this.coupon.is_enabled=this.isCreateCoupon?0:this.coupon.is_enabled},dateFormat(s){this.coupon.due_date=this.twTimeToTimestamp(s)}},methods:{timestampToTwTime:M,twTimeToTimestamp:x,createCoupon(){this.$http.post(`${v}/api/${g}/admin/coupon`,{data:this.coupon}).then(()=>{this.$emit("read-coupons"),this.modal.hide()}).catch(s=>{console.log(s.message)})},updateCoupon(){const s={...this.coupon};delete s.id,this.$http.put(`${v}/api/${g}/admin/coupon/${this.coupon.id}`,{data:s}).then(()=>{this.$emit("read-coupons"),this.modal.hide()}).catch(e=>{console.log(e.message)})}},mounted(){this.modal=new T(this.$refs.modal),this.$emit("coupon-modal",this.modal)}},N={ref:"modal",class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},U={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg"},$={class:"modal-content"},O={class:"modal-header bg-secondary"},L={class:"modal-title fs-5",id:"exampleModalLabel"},F=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),B={class:"modal-body"},J={class:"mb-3"},q=o("label",{for:"title",class:"form-label"},"標題",-1),j={class:"mb-3"},H=o("label",{for:"code",class:"form-label"},"優惠碼",-1),z={class:"mb-3"},G=o("label",{for:"percent",class:"form-label"},"優惠折",-1),K={class:"mb-3"},Q=o("label",{class:"form-label",for:"is_enabled"},"是否啟用",-1),W={class:"mb-3"},X=o("label",{for:"due_date",class:"form-label"},"到期日",-1),Y=o("div",{class:"modal-footer"},[o("a",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉"),o("button",{type:"submit",class:"btn btn-primary"},"儲存")],-1);function Z(s,e,u,V,t,l){const r=p("v-field"),m=p("error-message"),h=p("VueDatePicker"),n=p("v-form");return _(),y(n,{onSubmit:e[5]||(e[5]=c=>t.isCreateCoupon?l.createCoupon():l.updateCoupon())},{default:D(({errors:c})=>[o("div",N,[o("div",U,[o("div",$,[o("div",O,[o("h1",L,d(t.isCreateCoupon?"新增優惠卷":"編輯優惠卷"),1),F]),o("div",B,[o("div",J,[q,a(r,{id:"title",class:b([{"is-invalid":c.標題},"form-control"]),name:"標題",rules:"required",type:"text",value:t.coupon.title,modelValue:t.coupon.title,"onUpdate:modelValue":e[0]||(e[0]=i=>t.coupon.title=i)},null,8,["class","value","modelValue"]),a(m,{name:"優惠碼",class:"invalid-feedback"})]),o("div",j,[H,a(r,{id:"code",class:b([{"is-invalid":c.優惠碼},"form-control"]),name:"優惠碼",rules:"required",type:"text",value:t.coupon.code,modelValue:t.coupon.code,"onUpdate:modelValue":e[1]||(e[1]=i=>t.coupon.code=i)},null,8,["class","value","modelValue"]),a(m,{name:"優惠碼",class:"invalid-feedback"})]),o("div",z,[G,a(r,{id:"percent",class:b([{"is-invalid":c.優惠折},"form-control"]),name:"優惠折",rules:"required",type:"number",max:"99",min:"1",value:t.coupon.percent,modelValue:t.coupon.percent,"onUpdate:modelValue":e[2]||(e[2]=i=>t.coupon.percent=i)},null,8,["class","value","modelValue"]),a(m,{name:"優惠折",class:"invalid-feedback"})]),o("div",K,[w(o("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>t.coupon.is_enabled=i),"true-value":1,"false-value":0,type:"checkbox",class:"form-check-input me-2 border-3 border",id:"is_enabled"},null,512),[[E,t.coupon.is_enabled]]),Q]),o("div",W,[X,a(h,{id:"due_date","text-input":"",format:"yyyy/MM/dd HH:mm",modelValue:t.dateFormat,"onUpdate:modelValue":e[4]||(e[4]=i=>t.dateFormat=i),"min-date":new Date,clearable:!1},null,8,["modelValue","min-date"])])]),Y])])],512)]),_:1})}const oo=P(S,[["render",Z]]);var eo={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_API_NAME:"ektodorwang-api",BASE_URL:"/ghibli-store/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:to,VITE_APP_API_NAME:no}=eo,so={data(){return{coupons:[],pagination:{},tempCoupon:{},couponModal:null,deleteModal:null}},components:{PaginationComponent:A,CouponComponent:oo,DeleteModalComponent:I},methods:{timestampToTwTime:M,openCouponModal(s={}){this.tempCoupon=JSON.parse(JSON.stringify(s)),this.couponModal.show()},readCoupons(s=1){const e=this.$loading.show();this.$http.get(`${to}/api/${no}/admin/coupons?page=${s}`).then(u=>{this.coupons=u.data.coupons,this.pagination=u.data.pagination,e.hide()}).catch(u=>{console.log(u.message)})},openDeleteModal(s){this.tempCoupon=JSON.parse(JSON.stringify(s)),this.deleteModal.show()}},mounted(){this.readCoupons()}},lo={class:"table-responsive-lg"},ao={class:"table text-center align-middle table-hover"},io=o("thead",null,[o("tr",null,[o("th",{scope:"col"},"#"),o("th",{scope:"col"},"標題"),o("th",{scope:"col"},"優惠碼"),o("th",{scope:"col"},"優惠折"),o("th",{scope:"col"},"是否啟用"),o("th",{scope:"col"},"到期日"),o("th",{scope:"col"})])],-1),po={scope:"row"},uo={class:"btn-group"},co=["onClick"],ro=["onClick"],mo={class:"text-end mt-auto d-flex align-items-center"};function _o(s,e,u,V,t,l){const r=p("PaginationComponent"),m=p("CouponComponent"),h=p("DeleteModalComponent");return _(),C(f,null,[o("div",lo,[o("table",ao,[io,o("tbody",null,[(_(!0),C(f,null,k(t.coupons,n=>(_(),C("tr",{key:n},[o("th",po,d(n.num),1),o("td",null,d(n.title),1),o("td",null,d(n.code),1),o("td",null,d(n.percent),1),o("td",null,d(n.is_enabled?"是":"否"),1),o("td",null,d(l.timestampToTwTime(n.due_date)),1),o("td",null,[o("div",uo,[o("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:c=>l.openCouponModal(n)}," 編輯 ",8,co),o("button",{onClick:c=>l.openDeleteModal(n),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,ro)])])]))),128))])])]),o("div",mo,[a(r,{pagination:t.pagination,onCurrentPage:l.readCoupons},null,8,["pagination","onCurrentPage"]),o("button",{onClick:e[0]||(e[0]=n=>l.openCouponModal({})),class:"btn btn-primary ms-auto"},"建立優惠卷")]),a(m,{onReadCoupons:l.readCoupons,tempCoupon:t.tempCoupon,onCouponModal:e[1]||(e[1]=n=>t.couponModal=n)},null,8,["onReadCoupons","tempCoupon"]),a(h,{url:`coupon/${t.tempCoupon.id}`,onDeleteModal:e[2]||(e[2]=n=>t.deleteModal=n),onReadData:l.readCoupons},null,8,["url","onReadData"])],64)}const vo=P(so,[["render",_o]]);export{vo as default};
