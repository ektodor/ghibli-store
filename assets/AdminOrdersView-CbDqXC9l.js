import{t as k}from"./utils-sTL9UzG1.js";import{P as w}from"./PaginationComponent-VuTMZ9Ge.js";import{_ as A,M as C,r as u,o as _,k as E,w as I,b as e,a as r,n as p,c as h,g as M,t as c,d as P,j as D,q as b,F as f,v as T}from"./index-zk9T54vD.js";import{D as U}from"./DeleteModalComponent-dYx6AnDV.js";var R={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_API_NAME:"ektodorwang-api",BASE_URL:"/ghibli-store/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:N,VITE_APP_API_NAME:S}=R,L={data(){return{modal:null,order:{user:{},product:{}}}},emits:["order-modal","read-data"],props:["tempOrder"],watch:{tempOrder(){this.order=this.tempOrder}},methods:{updateOrder(){console.log("updateOrder"),this.$http.put(`${N}/api/${S}/admin/order/${this.order.id}`,{order:this.order}).then(d=>{console.log(d.data),this.$emit("read-data")}).catch(d=>{console.dir(d.message)})},deleteItem(d){delete this.order.products[d],console.log(this.order)}},mounted(){this.modal=new C(this.$refs.modal),this.$emit("order-modal",this.modal)}},q={id:"editOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"editOrderModalLabel","aria-hidden":"true",ref:"modal"},B={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg"},$={class:"modal-content border-0"},J=e("div",{class:"modal-header bg-secondary"},[e("h5",{id:"editOrderModalLabel",class:"modal-title"},[e("span",null,"編輯訂單")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),F={class:"modal-body"},j={class:"mb-3"},z=e("label",{for:"name",class:"form-label"},"姓名",-1),G={class:"mb-3"},H=e("label",{for:"email",class:"form-label"},"信箱",-1),K={class:"mb-3"},Q=e("label",{for:"tel",class:"form-label"},"電話",-1),W={class:"mb-3"},X=e("label",{for:"address",class:"form-label"},"地址",-1),Y={class:"mb-3"},Z=e("label",{for:"message",class:"form-label"},"留言",-1),ee={class:"card mb-3",style:{"max-width":"540px"}},oe={class:"row g-0"},se={class:"col-md-4"},te=["src"],le={class:"col-md-8"},de={class:"card-body"},re={class:"card-title"},ae=["id","value","onUpdate:modelValue"],ne=["onClick"],ie={class:"mb-3"},ce=e("label",{class:"form-label",for:"is_paid"},"是否付款",-1),me={class:"modal-footer"},ue=e("a",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function _e(d,s,m,x,o,a){const n=u("v-field"),i=u("error-message"),v=u("v-form");return _(),E(v,null,{default:I(({errors:l})=>[e("div",q,[e("div",B,[e("div",$,[J,e("div",F,[e("div",j,[z,r(n,{id:"name",class:p([{"is-invalid":l.姓名},"form-control"]),name:"姓名",rules:"required",type:"text",modelValue:o.order.user.name,"onUpdate:modelValue":s[0]||(s[0]=t=>o.order.user.name=t),value:o.order.user.name},null,8,["class","modelValue","value"]),r(i,{name:"姓名",class:"invalid-feedback"})]),e("div",G,[H,r(n,{id:"email",class:p([{"is-invalid":l.信箱},"form-control"]),name:"信箱",rules:"required",type:"email",value:o.order.user.email,modelValue:o.order.user.email,"onUpdate:modelValue":s[1]||(s[1]=t=>o.order.user.email=t)},null,8,["class","value","modelValue"]),r(i,{name:"信箱",class:"invalid-feedback"})]),e("div",K,[Q,r(n,{id:"tel",class:p([{"is-invalid":l.電話},"form-control"]),name:"電話",rules:"required",type:"tel",value:o.order.user.tel,modelValue:o.order.user.tel,"onUpdate:modelValue":s[2]||(s[2]=t=>o.order.user.tel=t)},null,8,["class","value","modelValue"]),r(i,{name:"電話",class:"invalid-feedback"})]),e("div",W,[X,r(n,{id:"address",class:p([{"is-invalid":l.地址},"form-control"]),name:"地址",rules:"required",type:"text",value:o.order.user.address,modelValue:o.order.user.address,"onUpdate:modelValue":s[3]||(s[3]=t=>o.order.user.address=t)},null,8,["class","value","modelValue"]),r(i,{name:"地址",class:"invalid-feedback"})]),e("div",Y,[Z,r(n,{as:"textarea",id:"message",class:p([{"is-invalid":l.留言},"form-control"]),name:"留言",type:"text",value:o.order.message,modelValue:o.order.message,"onUpdate:modelValue":s[4]||(s[4]=t=>o.order.message=t)},null,8,["class","value","modelValue"]),r(i,{name:"留言",class:"invalid-feedback"})]),(_(!0),h(f,null,M(o.order.products,(t,g)=>(_(),h("div",{class:"mb-3",key:g},[e("div",ee,[e("div",oe,[e("div",se,[e("img",{src:t.product.imageUrl,alt:"img",style:{"max-width":"100px"}},null,8,te)]),e("div",le,[e("div",de,[e("h5",re,c(t.product.title),1),P(e("input",{id:g,type:"number",min:"1",class:"form-control",value:t.qty,"onUpdate:modelValue":O=>t.qty=O},null,8,ae),[[D,t.qty]]),e("a",{class:"btn btn-warning mt-2",onClick:b(O=>a.deleteItem(t.id),["prevent"])},"刪除",8,ne)])])])])]))),128)),e("div",ie,[P(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>o.order.is_paid=t),"true-value":!0,"false-value":!1,type:"checkbox",class:"form-check-input me-2 border-3 border",id:"is_paid"},null,512),[[T,o.order.is_paid]]),ce])]),e("div",me,[ue,e("button",{type:"submit",class:"btn text-dark btn-success",onClick:s[6]||(s[6]=b((...t)=>a.updateOrder&&a.updateOrder(...t),["prevent"]))}," 更新 ")])])])],512)]),_:1})}const pe=A(L,[["render",_e]]);var he={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_API_NAME:"ektodorwang-api",BASE_URL:"/ghibli-store/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:y,VITE_APP_API_NAME:V}=he,be={data(){return{orders:[],pagination:{},tempOrder:{},editModal:null,timestampToTwTime:k,deleteModal:null}},components:{PaginationComponent:w,OrderComponent:pe,DeleteModalComponent:U},methods:{openEditModal(d){this.tempOrder=JSON.parse(JSON.stringify(d)),this.editModal.show()},openDeleteModal(d){this.tempOrder=JSON.parse(JSON.stringify(d)),this.deleteModal.show()},readOrders(d=1){const s=this.$loading.show();this.$http.get(`${y}/api/${V}/admin/orders?page=${d}`).then(m=>{this.orders=m.data.orders,this.pagination=m.data.pagination,s.hide()}).catch(m=>{console.err(m.message)})},deleteAllOrders(){this.$http.delete(`${y}/api/${V}/admin/orders/all`).then(()=>{this.readOrders()}).catch(d=>{console.err(d.message)})}},mounted(){this.readOrders()}},ve={class:"table-responsive-lg"},fe={class:"table text-center align-middle"},ge=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col",style:{"min-width":"250px"}},"訂單編號"),e("th",{scope:"col",style:{"min-width":"100px"}},"訂購人"),e("th",{scope:"col",style:{"min-width":"100px"}},"訂單金額"),e("th",{scope:"col",style:{"min-width":"100px"}},"是否付款"),e("th",{scope:"col",style:{"min-width":"200px"}},"訂購日期"),e("th",{scope:"col",style:{"min-width":"150px"}},"訂單資訊")])],-1),Oe={scope:"row"},Pe={class:"btn-group"},ye=["onClick"],Ve=["onClick"],Ae={class:"text-end mt-auto d-flex align-items-center"},Me=["disabled"];function xe(d,s,m,x,o,a){const n=u("PaginationComponent"),i=u("OrderComponent"),v=u("DeleteModalComponent");return _(),h(f,null,[e("div",ve,[e("table",fe,[ge,e("tbody",null,[(_(!0),h(f,null,M(o.orders,l=>(_(),h("tr",{key:l},[e("th",Oe,c(l.num),1),e("td",null,c(l.id),1),e("td",null,c(l.user.name),1),e("td",null,c(l.total),1),e("td",null,c(l.is_paid?"是":"否"),1),e("td",null,c(o.timestampToTwTime(l.create_at)),1),e("td",null,[e("div",Pe,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:t=>a.openEditModal(l)}," 編輯 ",8,ye),e("button",{onClick:b(t=>a.openDeleteModal(l),["prevent"]),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,Ve)])])]))),128))])])]),e("div",Ae,[r(n,{pagination:o.pagination,onCurrentPage:a.readOrders},null,8,["pagination","onCurrentPage"]),e("button",{disabled:o.orders.length<1,type:"button",class:"btn btn-primary ms-auto",onClick:s[0]||(s[0]=b((...l)=>a.deleteAllOrders&&a.deleteAllOrders(...l),["prevent"]))}," 刪除所有訂單 ",8,Me)]),r(i,{onReadData:a.readOrders,onOrderModal:s[1]||(s[1]=l=>o.editModal=l),tempOrder:o.tempOrder},null,8,["onReadData","tempOrder"]),r(v,{url:`order/${o.tempOrder.id}`,onDeleteModal:s[2]||(s[2]=l=>o.deleteModal=l),onReadData:a.readOrders},null,8,["url","onReadData"])],64)}const Ie=A(be,[["render",xe]]);export{Ie as default};
