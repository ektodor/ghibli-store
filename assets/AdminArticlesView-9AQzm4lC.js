import{t as k,a as E}from"./utils-sTL9UzG1.js";import{P as I}from"./PaginationComponent-VuTMZ9Ge.js";import{D}from"./DeleteModalComponent-dYx6AnDV.js";import{_ as w,M as R,r as p,o as n,k as U,w as S,b as t,t as r,d as b,j as P,a as d,n as A,q as x,c,g as f,h as N,F as g,s as L,v as O}from"./index-zk9T54vD.js";var $={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_API_NAME:"ektodorwang-api",BASE_URL:"/ghibli-store/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:y,VITE_APP_API_NAME:M}=$,B={data(){return{article:{},tag:"",tags:[],coupon:"無優惠卷",isCreateArticle:!1,modal:null}},props:["tempArticle","coupons"],emits:["article-modal","read-articles"],watch:{tempArticle(){this.article=this.tempArticle,this.isCreateArticle=!(Object.keys(this.article).length>0),this.article.isPublic=this.isCreateArticle?!1:this.article.isPublic,this.article.content="內容",this.isCreateArticle?(this.tags=[],this.coupon="無優惠卷"):(this.tags=this.article.tags[0].tags,this.coupon=this.article.tags[0].coupon)}},methods:{timestampToTwTime:k,twTimeToTimestamp:E,createArticle(){const a=[{tags:this.tags,coupon:this.coupon}];this.article.tags=a,this.article.create_at=Math.floor(new Date().getTime()/1e3),console.log(this.article),this.$http.post(`${y}/api/${M}/admin/article`,{data:this.article}).then(()=>{this.$emit("read-articles"),this.modal.hide()}).catch(e=>{console.dir(e.message)})},updateArticle(){const a=[{tags:this.tags,coupon:this.coupon}];this.article.tags=a,console.log(this.article),this.$http.put(`${y}/api/${M}/admin/article/${this.article.id}`,{data:this.article}).then(()=>{this.$emit("read-articles"),this.modal.hide()}).catch(e=>{console.dir(e.message)})},addTag(){this.tags.push(this.tag),this.tag=""},deleteTag(a){this.tags=this.tags.filter(e=>e!==a)}},mounted(){this.modal=new R(this.$refs.modal),this.$emit("article-modal",this.modal)}},j={ref:"modal",class:"modal fade",id:"articleModal",tabindex:"-1","aria-labelledby":"articleModalLabel","aria-hidden":"true"},q={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg"},J={class:"modal-content"},F={class:"modal-header bg-secondary"},z={class:"modal-title fs-5",id:"articleModalLabel"},G=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),H={class:"modal-body"},K={class:"card mb-3 m-auto",style:{"max-width":"540px"}},Q={class:"row g-0"},W={class:"col-4"},X=["src"],Y={class:"col-md-8"},Z={class:"card-body"},tt=t("label",{for:"imageUrl",class:"form-label card-text"},[t("small",{class:"text-muted"},"輸入圖片網址")],-1),et={class:"mb-3 row"},st={class:"col-6"},ot=t("label",{for:"title",class:"form-label"},"標題",-1),lt={class:"col-6"},at=t("label",{for:"author",class:"form-label"},"作者",-1),it={class:"mb-3"},nt=t("label",{for:"description",class:"form-label"},"簡介",-1),ct={class:"mb-3"},rt=t("label",{class:"form-label",for:"tag"},"標籤",-1),dt={class:"d-flex"},ut={class:"mt-2 d-flex gap-2 flex-wrap"},pt=["onClick"],mt={class:"mb-3"},ht=t("label",{class:"form-label",for:"coupons"},"優惠卷",-1),_t=t("option",{selected:"",value:"無優惠卷"},"請選擇搭配優惠卷",-1),gt=["value"],bt=["value"],ft={class:"mb-3"},vt=t("label",{class:"form-label",for:"is_enabled"},"是否公開",-1),At=t("div",{class:"modal-footer"},[t("a",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉"),t("button",{type:"submit",class:"btn btn-primary"},"儲存")],-1);function Pt(a,e,u,T,s,i){const m=p("v-field"),h=p("error-message"),v=p("v-form");return n(),U(v,{onSubmit:e[8]||(e[8]=l=>s.isCreateArticle?i.createArticle():i.updateArticle())},{default:S(({errors:l})=>[t("div",j,[t("div",q,[t("div",J,[t("div",F,[t("h1",z,r(s.isCreateArticle?"新增文章":"編輯文章"),1),G]),t("div",H,[t("div",K,[t("div",Q,[t("div",W,[t("img",{src:s.article.image,class:"img-fluid rounded-start h-100",alt:"photo"},null,8,X)]),t("div",Y,[t("div",Z,[tt,b(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=o=>s.article.image=o)},null,512),[[P,s.article.image]])])])])]),t("div",et,[t("div",st,[ot,d(m,{id:"title",class:A([{"is-invalid":l.標題},"form-control"]),name:"標題",rules:"required",type:"text",value:s.article.title,modelValue:s.article.title,"onUpdate:modelValue":e[1]||(e[1]=o=>s.article.title=o)},null,8,["class","value","modelValue"]),d(h,{name:"標題",class:"invalid-feedback"})]),t("div",lt,[at,d(m,{id:"author",class:A([{"is-invalid":l.作者},"form-control"]),name:"作者",rules:"required",type:"text",value:s.article.author,modelValue:s.article.author,"onUpdate:modelValue":e[2]||(e[2]=o=>s.article.author=o)},null,8,["class","value","modelValue"]),d(h,{name:"作者",class:"invalid-feedback"})])]),t("div",it,[nt,d(m,{as:"textarea",id:"description",class:A([{"is-invalid":l.簡介},"form-control"]),rules:"required",name:"簡介",type:"text",value:s.article.description,modelValue:s.article.description,"onUpdate:modelValue":e[3]||(e[3]=o=>s.article.description=o)},null,8,["class","value","modelValue"]),d(h,{name:"簡介",class:"invalid-feedback"})]),t("div",ct,[rt,t("div",dt,[b(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>s.tag=o),type:"text",class:"form-control me-2 border-3 border",id:"tag"},null,512),[[P,s.tag]]),t("a",{onClick:e[5]||(e[5]=x((...o)=>i.addTag&&i.addTag(...o),["prevent"])),class:"btn border border-2 w-50 btn-secondary"},"新增標籤")]),t("div",ut,[(n(!0),c(g,null,f(s.tags,o=>(n(),c("span",{key:o,class:"p-2 badge text-bg-warning justify-content-center align-items-center d-flex"},[N(r(o),1),t("a",{class:"btn-close btn-close-black ms-1 btn",style:{height:"5px"},onClick:x(_=>i.deleteTag(o),["prevent"])},null,8,pt)]))),128))])]),t("div",mt,[ht,b(t("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>s.coupon=o),class:"form-control me-2 border-3 border",id:"coupons"},[_t,(n(!0),c(g,null,f(u.coupons,o=>(n(),c("option",{key:o.due_date,value:o.code},r(o.title),9,gt))),128))],512),[[L,s.coupon]]),t("input",{type:"text",class:"mt-3",value:s.coupon,disabled:""},null,8,bt)]),t("div",ft,[b(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>s.article.isPublic=o),"true-value":!0,"false-value":!1,type:"checkbox",class:"form-check-input me-2 border-3 border",id:"is_enabled"},null,512),[[O,s.article.isPublic]]),vt])]),At])])],512)]),_:1})}const xt=w(B,[["render",Pt]]);var yt={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_API_NAME:"ektodorwang-api",BASE_URL:"/ghibli-store/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_NAME:C,VITE_APP_API_URL:V}=yt,Mt={data(){return{tempArticle:{},pagination:[],articles:[],editModal:null,timestampToTwTime:k,coupons:[],deleteModal:null}},methods:{openEditModal(a={}){this.tempArticle=JSON.parse(JSON.stringify(a)),this.editModal.show()},openDeleteModal(a={}){this.tempArticle=JSON.parse(JSON.stringify(a)),this.deleteModal.show()},readArticles(a=1){const e=this.$loading.show();this.$http.get(`${V}/api/${C}/admin/articles?page=${a}`).then(u=>{this.articles=u.data.articles,this.pagination=u.data.pagination,e.hide()}).catch(u=>{console.log(u.message)})},readCoupons(a=1){this.$http.get(`${V}/api/${C}/admin/coupons?page=${a}`).then(e=>{this.coupons=e.data.coupons,this.pagination=e.data.pagination}).catch(e=>{console.log(e.message)})}},components:{PaginationComponent:I,DeleteModalComponent:D,ArticleComponent:xt},mounted(){this.readArticles(),this.readCoupons()}},Ct={class:"table-responsive-lg"},Vt={class:"table text-center align-middle table-hover"},kt=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"#"),t("th",{scope:"col"},"標題"),t("th",{scope:"col"},"作者"),t("th",{scope:"col"},"標籤"),t("th",{scope:"col"},"優惠碼"),t("th",{scope:"col"},"是否公開"),t("th",{scope:"col"},"創建時間"),t("th",{scope:"col"})])],-1),wt={scope:"row"},Tt={style:{width:"100px"}},Et={key:0,class:"d-flex flex-wrap gap-1 justify-content-center"},It={key:1,class:"badge text-bg-warning"},Dt={class:"btn-group"},Rt=["onClick"],Ut=["onClick"],St={class:"text-end mt-auto d-flex align-items-center"};function Nt(a,e,u,T,s,i){const m=p("PaginationComponent"),h=p("DeleteModalComponent"),v=p("ArticleComponent");return n(),c(g,null,[t("div",Ct,[t("table",Vt,[kt,t("tbody",null,[(n(!0),c(g,null,f(s.articles,l=>{var o;return n(),c("tr",{key:l},[t("th",wt,r(l.num),1),t("td",null,r(l.title),1),t("td",null,r(l.author),1),t("td",Tt,[((o=l.tags[0].tags)==null?void 0:o.length)>0?(n(),c("div",Et,[(n(!0),c(g,null,f(l.tags[0].tags,_=>(n(),c("span",{key:_,class:"badge text-bg-warning"},r(_),1))),128))])):(n(),c("span",It,"無標籤"))]),t("td",null,r(l.tags[0].coupon),1),t("td",null,r(l.isPublic?"是":"否"),1),t("td",null,r(s.timestampToTwTime(l.create_at)),1),t("td",null,[t("div",Dt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:_=>i.openEditModal(l)}," 編輯 ",8,Rt),t("button",{onClick:_=>i.openDeleteModal(l),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,Ut)])])])}),128))])])]),t("div",St,[d(m,{pagination:s.pagination,onCurrentPage:i.readArticles},null,8,["pagination","onCurrentPage"]),t("button",{class:"btn btn-primary ms-auto",onClick:e[0]||(e[0]=l=>i.openEditModal({}))},"新增文章")]),d(h,{url:`article/${s.tempArticle.id}`,onDeleteModal:e[1]||(e[1]=l=>s.deleteModal=l),onReadData:i.readArticles},null,8,["url","onReadData"]),d(v,{coupons:s.coupons,onReadArticles:i.readArticles,tempArticle:s.tempArticle,onArticleModal:e[2]||(e[2]=l=>s.editModal=l)},null,8,["coupons","onReadArticles","tempArticle"])],64)}const jt=w(Mt,[["render",Nt]]);export{jt as default};
