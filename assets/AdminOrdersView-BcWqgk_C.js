import{t as k}from"./utils-CnJ9Rcy0.js";import{P as w}from"./PaginationComponent-BbM6pXU3.js";import{_ as A,M as C,r as u,o as _,k as E,w as I,b as e,a as r,n as p,c as h,i as M,t as c,d as P,j as D,x as b,F as f,v as T}from"./index-CT0q0FpJ.js";import{D as U}from"./DeleteModalComponent-ZBvH_BGp.js";var R={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_API_NAME:"ektodorwang-api",BASE_URL:"/ghibli-store/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:N,VITE_APP_API_NAME:S}=R,L={data(){return{modal:null,order:{user:{},product:{}}}},emits:["order-modal","read-data"],props:["tempOrder"],watch:{tempOrder(){this.order=this.tempOrder}},methods:{updateOrder(){this.$http.put(`${N}/api/${S}/admin/order/${this.order.id}`,{data:this.order}).then(()=>{this.$emit("read-data")}).catch(d=>{console.dir(d.message)})},deleteItem(d){delete this.order.products[d]}},mounted(){this.modal=new C(this.$refs.modal),this.$emit("order-modal",this.modal)}},q={id:"editOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"editOrderModalLabel","aria-hidden":"true",ref:"modal"},B={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg"},$={class:"modal-content border-0"},J=e("div",{class:"modal-header bg-secondary"},[e("h5",{id:"editOrderModalLabel",class:"modal-title"},[e("span",null,"編輯訂單")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),F={class:"modal-body"},j={class:"mb-3"},z=e("label",{for:"name",class:"form-label"},"姓名",-1),G={class:"mb-3"},H=e("label",{for:"email",class:"form-label"},"信箱",-1),K={class:"mb-3"},Q=e("label",{for:"tel",class:"form-label"},"電話",-1),W={class:"mb-3"},X=e("label",{for:"address",class:"form-label"},"地址",-1),Y={class:"mb-3"},Z=e("label",{for:"message",class:"form-label"},"留言",-1),ee={class:"card mb-3 mx-auto",style:{"max-width":"540px"}},se={class:"row g-0"},te={class:"col-md-4"},oe=["src"],le={class:"col-md-8"},de={class:"card-body"},re={class:"card-title"},ae=["id","value","onUpdate:modelValue"],ne=["onClick"],ie={class:"mb-3"},ce=e("label",{class:"form-label",for:"is_paid"},"是否付款",-1),me={class:"modal-footer"},ue=e("a",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function _e(d,t,m,x,s,a){const n=u("v-field"),i=u("error-message"),v=u("v-form");return _(),E(v,null,{default:I(({errors:l})=>[e("div",q,[e("div",B,[e("div",$,[J,e("div",F,[e("div",j,[z,r(n,{id:"name",class:p([{"is-invalid":l.姓名},"form-control"]),name:"姓名",rules:"required",type:"text",modelValue:s.order.user.name,"onUpdate:modelValue":t[0]||(t[0]=o=>s.order.user.name=o),value:s.order.user.name},null,8,["class","modelValue","value"]),r(i,{name:"姓名",class:"invalid-feedback"})]),e("div",G,[H,r(n,{id:"email",class:p([{"is-invalid":l.信箱},"form-control"]),name:"信箱",rules:"required",type:"email",value:s.order.user.email,modelValue:s.order.user.email,"onUpdate:modelValue":t[1]||(t[1]=o=>s.order.user.email=o)},null,8,["class","value","modelValue"]),r(i,{name:"信箱",class:"invalid-feedback"})]),e("div",K,[Q,r(n,{id:"tel",class:p([{"is-invalid":l.電話},"form-control"]),name:"電話",rules:"required",type:"tel",value:s.order.user.tel,modelValue:s.order.user.tel,"onUpdate:modelValue":t[2]||(t[2]=o=>s.order.user.tel=o)},null,8,["class","value","modelValue"]),r(i,{name:"電話",class:"invalid-feedback"})]),e("div",W,[X,r(n,{id:"address",class:p([{"is-invalid":l.地址},"form-control"]),name:"地址",rules:"required",type:"text",value:s.order.user.address,modelValue:s.order.user.address,"onUpdate:modelValue":t[3]||(t[3]=o=>s.order.user.address=o)},null,8,["class","value","modelValue"]),r(i,{name:"地址",class:"invalid-feedback"})]),e("div",Y,[Z,r(n,{as:"textarea",id:"message",class:p([{"is-invalid":l.留言},"form-control"]),name:"留言",type:"text",value:s.order.message,modelValue:s.order.message,"onUpdate:modelValue":t[4]||(t[4]=o=>s.order.message=o)},null,8,["class","value","modelValue"]),r(i,{name:"留言",class:"invalid-feedback"})]),(_(!0),h(f,null,M(s.order.products,(o,g)=>(_(),h("div",{class:"mb-3",key:g},[e("div",ee,[e("div",se,[e("div",te,[e("img",{src:o.product.imageUrl,class:"img-fluid w-100 rounded-3",alt:"img"},null,8,oe)]),e("div",le,[e("div",de,[e("h5",re,c(o.product.title),1),P(e("input",{id:g,type:"number",min:"1",class:"form-control",value:o.qty,"onUpdate:modelValue":O=>o.qty=O},null,8,ae),[[D,o.qty]]),e("a",{class:"btn btn-warning mt-2",onClick:b(O=>a.deleteItem(o.id),["prevent"])},"刪除",8,ne)])])])])]))),128)),e("div",ie,[P(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.order.is_paid=o),"true-value":!0,"false-value":!1,type:"checkbox",class:"form-check-input me-2 border-3 border",id:"is_paid"},null,512),[[T,s.order.is_paid]]),ce])]),e("div",me,[ue,e("button",{type:"submit",class:"btn text-dark btn-success",onClick:t[6]||(t[6]=b((...o)=>a.updateOrder&&a.updateOrder(...o),["prevent"]))}," 更新 ")])])])],512)]),_:1})}const pe=A(L,[["render",_e]]);var he={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_API_NAME:"ektodorwang-api",BASE_URL:"/ghibli-store/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:y,VITE_APP_API_NAME:V}=he,be={data(){return{orders:[],pagination:{},tempOrder:{},editModal:null,timestampToTwTime:k,deleteModal:null}},components:{PaginationComponent:w,OrderComponent:pe,DeleteModalComponent:U},methods:{openEditModal(d){this.tempOrder=JSON.parse(JSON.stringify(d)),this.editModal.show()},openDeleteModal(d){this.tempOrder=JSON.parse(JSON.stringify(d)),this.deleteModal.show()},readOrders(d=1){const t=this.$loading.show();this.$http.get(`${y}/api/${V}/admin/orders?page=${d}`).then(m=>{this.orders=m.data.orders,this.pagination=m.data.pagination,t.hide()}).catch(m=>{console.error(m.message)})},deleteAllOrders(){this.$http.delete(`${y}/api/${V}/admin/orders/all`).then(()=>{this.readOrders()}).catch(d=>{console.error(d.message)})}},mounted(){this.readOrders()}},ve={class:"table-responsive-lg"},fe={class:"table text-center align-middle"},ge=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col",style:{"min-width":"250px"}},"訂單編號"),e("th",{scope:"col",style:{"min-width":"100px"}},"訂購人"),e("th",{scope:"col",style:{"min-width":"100px"}},"訂單金額"),e("th",{scope:"col",style:{"min-width":"100px"}},"是否付款"),e("th",{scope:"col",style:{"min-width":"200px"}},"訂購日期"),e("th",{scope:"col",style:{"min-width":"150px"}},"訂單資訊")])],-1),Oe={scope:"row"},Pe={class:"btn-group"},ye=["onClick"],Ve=["onClick"],Ae={class:"text-end mt-auto d-flex align-items-center"},Me=["disabled"];function xe(d,t,m,x,s,a){const n=u("PaginationComponent"),i=u("OrderComponent"),v=u("DeleteModalComponent");return _(),h(f,null,[e("div",ve,[e("table",fe,[ge,e("tbody",null,[(_(!0),h(f,null,M(s.orders,l=>(_(),h("tr",{key:l},[e("th",Oe,c(l.num),1),e("td",null,c(l.id),1),e("td",null,c(l.user.name),1),e("td",null,c(l.total),1),e("td",null,c(l.is_paid?"是":"否"),1),e("td",null,c(s.timestampToTwTime(l.create_at)),1),e("td",null,[e("div",Pe,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:o=>a.openEditModal(l)}," 編輯 ",8,ye),e("button",{onClick:b(o=>a.openDeleteModal(l),["prevent"]),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,Ve)])])]))),128))])])]),e("div",Ae,[r(n,{pagination:s.pagination,onCurrentPage:a.readOrders},null,8,["pagination","onCurrentPage"]),e("button",{disabled:s.orders.length<1,type:"button",class:"btn btn-primary ms-auto",onClick:t[0]||(t[0]=b((...l)=>a.deleteAllOrders&&a.deleteAllOrders(...l),["prevent"]))}," 刪除所有訂單 ",8,Me)]),r(i,{onReadData:a.readOrders,onOrderModal:t[1]||(t[1]=l=>s.editModal=l),tempOrder:s.tempOrder},null,8,["onReadData","tempOrder"]),r(v,{url:`order/${s.tempOrder.id}`,onDeleteModal:t[2]||(t[2]=l=>s.deleteModal=l),onReadData:a.readOrders},null,8,["url","onReadData"])],64)}const Ie=A(be,[["render",xe]]);export{Ie as default};
